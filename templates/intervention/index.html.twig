{% extends 'base.html.twig' %}

{% block title %}Interventions{% endblock %}

{% block body %}
<style>
	.container {
		background-color: white !important;
		padding: 20px;
		margin-top: 150px;
	}

	.header-search {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 1rem;
		gap: 10px;
	}

	.header-search input.form-control {
		flex: 1;
		border-radius: 10px;
	}

	.table-custom {
		width: 100%;
		border-collapse: collapse;
	}

	.table-header,
	.table-row {
		display: flex;
		padding: 10px 15px;
		align-items: center;
		border-bottom: 1px solid #eee;
		transition: background 0.2s ease;
	}

	.table-header {
		font-weight: bold;
		text-transform: uppercase;
		background-color: #f5f5f5;
		color: #6c757d;
	}

	.table-cell {
		flex: 1;
		text-align: center;
		word-break: break-word;
	}

	.table-row {
		cursor: pointer;
	}

	.table-row:hover {
		background-color: #fdf2e9;
		box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
	}
</style>

{% if is_granted('ROLE_ADMIN') %}
	<div class="container">
		<div class="header-search">
			<input type="text" id="search-global" class="form-control" placeholder="Rechercher une borne, un client, une référence, un installateur...">
		</div>

		<div class="table-custom">
			<div class="table-header">
				<div class="table-cell">Nombre de bornes</div>
				<div class="table-cell">Client</div>
				<div class="table-cell">Installateur</div>
				<div class="table-cell">Référence</div>
			</div>

			{% for group in pagination %}
				{% set intervention = group.intervention %}
				<div class="table-row"
					 data-search="{{ group.nbBornes ~ ' ' ~ intervention.client.email ~ ' ' ~ (intervention.installator.name ~ ' ' ~ intervention.installator.lastname)|default('') ~ ' ' ~ group.refPrefix|default('') }}"
					 onclick="window.location.href='{{ path('intervention_client_show', { id: group.anyInterventionId }) }}'">
					<div class="table-cell">
						<small>{{ group.nbBornes }} borne{{ group.nbBornes > 1 ? 's' }}</small>
					</div>
					<div class="table-cell">
						{{ intervention.client.email ?? '—' }}
					</div>
					<div class="table-cell">
						{{ intervention.installator.name ?? 'Inconnu' }} {{ intervention.installator.lastname ?? '' }}
					</div>
					<div class="table-cell">
						{{ group.refPrefix ?? '—' }}
					</div>
				</div>
			{% else %}
				<p>Aucune intervention trouvée.</p>
			{% endfor %}
		</div>

		<div class="mt-4">
			{{ knp_pagination_render(pagination) }}
		</div>
	</div>
{% endif %}

<script>
	document.getElementById('search-global').addEventListener('input', function () {
		const search = this.value.toLowerCase();
		const rows = document.querySelectorAll('.table-row');

		rows.forEach(row => {
			const text = row.dataset.search.toLowerCase();
			row.style.display = text.includes(search) ? 'flex' : 'none';
		});
	});
</script>
{% endblock %}