{% extends 'base.html.twig' %}

{% block title %}Documentations - Borne de recharge{% endblock %}

{% block body %}
<style>
	:root {
		--primary: #ff4081;
		--secondary: #ff8c00;
		--gradient: linear-gradient(135deg, var(--primary), var(--secondary));
		--bg: #f0f2f5;
		--card-bg: rgba(255, 255, 255, 0.8);
		--card-radius: 1rem;
		--card-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
		--nav-height: 56px;
	}

	body {
		padding-top: var(--nav-height);
		background: #f0f2f5;
	}

	.page-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		border-bottom: 1px solid #ddd;
		padding: 1rem 0;
		margin-bottom: 2rem;
	}

	.page-header h2 {
		font-weight: 700;
		color: #333;
	}

	.search-wrapper {
		max-width: 400px;
		margin-bottom: 2rem;
	}

	.search-wrapper .input-group-text {
		background: var(--gradient);
		color: #fff;
		border: none;
		border-top-left-radius: 2rem;
		border-bottom-left-radius: 2rem;
	}

	.search-wrapper .form-control {
		border: none;
		border-top-right-radius: 2rem;
		border-bottom-right-radius: 2rem;
		padding-left: 1rem;
	}

	.btn-action {
		background: var(--gradient);
		color: #fff;
		border: none;
		border-radius: 2rem;
		padding: .5rem 1.5rem;
		transition: transform .3s;
	}

	.btn-action:hover {
		transform: translateY(-3px);
		box-shadow: var(--card-shadow);
	}

	.stations-grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
		gap: 1.5rem;
	}

	.station-card {
		background: var(--card-bg);
		backdrop-filter: blur(10px);
		border-radius: var(--card-radius);
		overflow: hidden;
		transition: transform .3s, box-shadow .3s;
		display: flex;
		flex-direction: column;
		height: 100%;
	}

	.station-card:hover {
		transform: translateY(-5px);
		box-shadow: var(--card-shadow);
	}

	.station-card .card-header {
		height: 140px;
		background-size: cover;
		background-position: center;
	}

	.station-card .card-body {
		flex: 1;
		padding: 1.25rem;
		text-align: center;
	}

	.station-card .card-body h5 {
		margin-bottom: .75rem;
		font-weight: 600;
		color: #222;
	}

	.station-card .info {
		display: flex;
		justify-content: center;
		gap: 1.5rem;
		margin-bottom: 1rem;
		color: #555;
		font-size: .9rem;
	}

	.station-card .info i {
		color: var(--primary);
		margin-right: .25rem;
	}

	.station-card .manufacturer {
		padding: .75rem;
		background: #fff;
		border-top: 1px solid #ddd;
		display: flex;
		justify-content: center;
	}

	.station-card .manufacturer img {
		max-height: 40px;
		object-fit: contain;
	}

	.station-card .card-footer {
		padding: .75rem;
		background: transparent;
		border-top: 1px dashed #ccc;
		display: flex;
		justify-content: center;
		gap: .5rem;
	}

	.modal-header {
		background: var(--gradient);
		color: #fff;
		border-top-left-radius: var(--card-radius);
		border-top-right-radius: var(--card-radius);
	}

	.modal-content {
		border-radius: var(--card-radius);
		overflow: hidden;
	}

	.form-control,
	.form-select {
		border-radius: .5rem;
	}

	.card-header {
		background-size: cover;
		background-position: center;
		background-repeat: no-repeat;
	}

	/* Se aplica vía JavaScript o CSS más abajo */
</style>

<div class="container py-4">
	<div class="page-header">
		<h2>Documentation des bornes</h2>
		{% if is_granted('ROLE_ADMIN') %}
		<div class="d-flex gap-2">
			<button class="btn-action" data-bs-toggle="modal" data-bs-target="#addStationModal">
				<i class="bi bi-plus-lg me-1"></i> Ajouter Borne
			</button>
			<button class="btn-action" data-bs-toggle="modal" data-bs-target="#addManufacturerModal">
				<i class="bi bi-building me-1"></i> Ajouter Constructeur
			</button>
		</div>
		{% endif %}
	</div>

	<div class="search-wrapper">
		<div class="input-group">
			<span class="input-group-text"><i class="bi bi-search"></i></span>
			<input id="global-search" type="text" class="form-control" placeholder="Rechercher une borne...">
		</div>
	</div>

	{% if chargingStations is not empty %}
	<div class="stations-grid">
		{% for station in chargingStations %}
		<div class="station-card"
			data-search="{{ (station.model ~ ' ' ~ (station.manufacturer.name|default('')) ~ ' ' ~ station.power ~ ' ' ~ station.connectors)|lower }}">
			<div class="card-header {{ station.image ? 'has-image' : 'no-image' }}"
				data-bg="{{ station.image ? asset('uploads/' ~ station.image) : asset('images/placeholder.jpg') }}">
			</div>

			<div class="card-body">
				<h5>{{ station.model }}</h5>
				<div class="info">
					<span><i class="bi bi-plug-fill"></i>{{ station.connectors }}</span>
					<span><i class="bi bi-bolt-fill"></i>{{ station.power }} kW</span>
				</div>
			</div>
			<div class="manufacturer">
				{% if station.manufacturer.image %}
				<img src="{{ asset('uploads/' ~ station.manufacturer.image) }}" alt="Logo">
				{% else %}
				<i class="bi bi-building fs-3 text-secondary"></i>
				{% endif %}
			</div>
			{% if is_granted('ROLE_ADMIN') %}
			<div class="card-footer">
				<a href="{{ path('charging_station_show',{slug:station.slug}) }}" class="text-primary">
					<i class="bi bi-pencil-square fs-5"></i>
				</a>
				<button class="btn p-0 text-danger" data-bs-toggle="modal"
					data-bs-target="#deleteStationModal{{ station.slug }}">
					<i class="bi bi-trash fs-5"></i>
				</button>
			</div>
			{% endif %}
		</div>

		{% if is_granted('ROLE_ADMIN') %}
		<div class="modal fade" id="deleteStationModal{{ station.slug }}" tabindex="-1">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Supprimer {{ station.model }}</h5>
						<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
					</div>
					<div class="modal-body">
						Voulez-vous vraiment supprimer <strong>{{ station.model }}</strong> ?
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
						<form method="POST" action="{{ path('charging_station_delete',{slug:station.slug}) }}">
							<button type="submit" class="btn btn-danger">Confirmer</button>
						</form>
					</div>
				</div>
			</div>
		</div>
		{% endif %}
		{% endfor %}
	</div>
	{% else %}
	<div class="alert alert-warning text-center">Aucune borne enregistrée.</div>
	{% endif %}
</div>

<!-- Add Station Modal -->
<div class="modal fade" id="addStationModal" tabindex="-1">
	<div class="modal-dialog modal-lg modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<i class="bi bi-plug-fill fs-3 me-2"></i>
				<h5 class="modal-title">Ajouter une Borne</h5>
				<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body">
				<form action="{{ path('charging_station_add') }}" method="post" enctype="multipart/form-data">
					{{ form_start(form) }}
					<div class="row gy-3">
						<div class="col-md-6">{{ form_row(form.model) }}</div>
						<div class="col-md-6">{{ form_row(form.power) }}</div>
						<div class="col-md-6">{{ form_row(form.connectors) }}</div>
						<div class="col-md-6">{{ form_row(form.manufacturer) }}</div>
						<div class="col-md-6">{{ form_row(form.image) }}</div>
						<div class="col-md-6 d-flex align-items-center">{{ form_row(form.isActive) }}</div>
					</div>
					<div class="text-end mt-4">
						<button type="submit" class="btn-action"><i class="bi bi-check-lg me-1"></i>
							Enregistrer</button>
					</div>
					{{ form_end(form) }}
				</form>
			</div>
		</div>
	</div>
</div>

<!-- Add Manufacturer Modal -->
<div class="modal fade" id="addManufacturerModal" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<i class="bi bi-building fs-3 me-2"></i>
				<h5 class="modal-title">Ajouter un Constructeur</h5>
				<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body">
				<form action="{{ path('manufacturer_add') }}" method="post" enctype="multipart/form-data">
					{{ form_start(manufacturerForm) }}
					<div class="mb-3">{{ form_row(manufacturerForm.name) }}</div>
					<div class="mb-3">{{ form_row(manufacturerForm.image) }}</div>
					<div class="text-end">
						<button type="submit" class="btn-action"><i class="bi bi-check-lg me-1"></i> Ajouter</button>
					</div>
					{{ form_end(manufacturerForm) }}
				</form>
			</div>
		</div>
	</div>
</div>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const search = document.getElementById('global-search');
		const cards = document.querySelectorAll('.station-card');
		search.addEventListener('input', () => {
			const q = search.value.toLowerCase();
			cards.forEach(card => {
				card.style.display = card.dataset.search.includes(q) ? '' : 'none';
			});
		});
	});
</script>
<script>
	document.querySelectorAll('.card-header').forEach(el => {
		const bg = el.getAttribute('data-bg');
		if (bg) {
			el.style.backgroundImage = `url('${bg}')`;
		}
	});
</script>
{% endblock %}